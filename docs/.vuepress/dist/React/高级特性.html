<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hello VuePress</title>
    <meta name="generator" content="VuePress 1.8.3">
    <link rel="icon" href="./logo.png">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/vuepress-studyNote/assets/css/0.styles.e88116b1.css" as="style"><link rel="preload" href="/vuepress-studyNote/assets/js/app.ff2d10b2.js" as="script"><link rel="preload" href="/vuepress-studyNote/assets/js/2.fb00c507.js" as="script"><link rel="preload" href="/vuepress-studyNote/assets/js/11.fa49d6b9.js" as="script"><link rel="prefetch" href="/vuepress-studyNote/assets/js/10.128cb97f.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/12.4ecb641c.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/13.813f78a3.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/14.dd37623c.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/15.42a0f85f.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/16.aff0b699.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/17.f4f64b16.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/18.a90d5cf1.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/19.9e85d01a.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/20.fdeba8ca.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/21.80029f92.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/22.64989a32.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/23.35abbd6d.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/24.a538fb6e.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/25.34be11cb.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/26.eb0b6464.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/27.1429e341.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/28.f37db598.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/29.c74b46e3.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/3.fbf83a7f.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/30.10281b12.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/31.4de025af.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/32.ab9def77.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/33.c29a332b.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/34.d82dd7df.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/35.b7e25d69.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/36.474da10b.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/37.441896f9.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/38.9423ed3a.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/4.b602b2f0.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/5.d5233f6e.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/6.270f939c.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/7.093196f8.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/8.1cb661a3.js"><link rel="prefetch" href="/vuepress-studyNote/assets/js/9.69f4edac.js">
    <link rel="stylesheet" href="/vuepress-studyNote/assets/css/0.styles.e88116b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-studyNote/" class="home-link router-link-active"><!----> <span class="site-name">Hello VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/vuepress-studyNote/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/vuepress-studyNote/网络原理.html" class="sidebar-link">网络原理</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-studyNote/React/基本使用.html" class="sidebar-link">基本使用</a></li><li><a href="/vuepress-studyNote/React/React事件.html" class="sidebar-link">React事件</a></li><li><a href="/vuepress-studyNote/React/Redux.html" class="sidebar-link">Redux</a></li><li><a href="/vuepress-studyNote/React/React-Router.html" class="sidebar-link">Router</a></li><li><a href="/vuepress-studyNote/React/高级特性.html" class="active sidebar-link">高级特性</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJs</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ol><li>函数组件
只接收props进行渲染没有state就可以使用函数组件</li></ol> <ul><li>纯函数，输入props输出jsx</li> <li>没有实例，没有生命周期，没有state</li> <li>不能扩展其他的方法输出tanshuikafei</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>list<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>Portals【传送门】
组件默认会按照既定层次嵌套渲染，但有些时候需要把自组件渲染到父组件以外
（比如一层层嵌套里面，有一个组件显示是fixed）
使用场景：overflow:hidden    父组件z-index值太小    fixed需要放在body第一层级</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return &lt;div className=&quot;modal&quot;&gt;</span>
    <span class="token comment">//     {this.props.children} {/* vue slot */}</span>
    <span class="token comment">// &lt;/div&gt;</span>

    <span class="token comment">// 使用 Portals 渲染到 body 上。</span>
    <span class="token comment">// fixed 元素要放在 body 上，有更好的浏览器兼容性。</span>
    <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
         <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;modal&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">,</span>
         document<span class="token punctuation">.</span>body <span class="token comment">// DOM 节点</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>第二个参数是指要渲染到什么地方去，但不会改变React组件结构
3. context
当用props太繁琐、用redux小题大做时</p> <ul><li>1)定义</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建 Context 填入默认值（任何一个 js 变量）</span>
<span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>2)在DOM最外层使用，包裹起来</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            theme<span class="token operator">:</span> <span class="token string">'light'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Toolbar <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>hr<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeTheme<span class="token punctuation">}</span><span class="token operator">&gt;</span>change theme<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">changeTheme</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            theme<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在最外层通过ThemeContext.Provider去生产、管理state里面这个值；之后子组件里都有消费这个数据的能力</p> <ul><li>3)中间组件：再也不必指明往下传递的数据了
如果中间组件需要使用数据，和最下层组件使用一致</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Toolbar</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ThemedButton <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ThemeLink <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>4)底层组件消费数据</li> <li>类组件</li></ul> <ul><li>（1）绑定指定的contextType</li> <li>（2）从下往上找数据，this.context获取</li></ul> <ul><li>函数组件：不能使用this</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 底层组件 - 函数是组件</span>
<span class="token keyword">function</span> <span class="token function">ThemeLink</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// const theme = this.context // 会报错。函数式组件没有实例，即没有 this</span>

    <span class="token comment">// 函数式组件可以使用 Consumer</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>link's theme is <span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 底层组件 - class 组件</span>
<span class="token keyword">class</span> <span class="token class-name">ThemedButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定 contextType 读取当前的 theme context。</span>
    <span class="token comment">// static contextType = ThemeContext // 也可以用 ThemedButton.contextType = ThemeContext</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token comment">// React 会往上找到最近的 theme Provider，然后使用它的值。</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>button's theme is <span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ThemedButton<span class="token punctuation">.</span>contextType <span class="token operator">=</span> ThemeContext <span class="token comment">// 指定 contextType 读取当前的 theme context。</span>
<span class="token comment">//组件的contextType属性等于上面创建定义的值</span>
</code></pre></div><ol start="4"><li>异步组件：组件比较大的时候、懒加载
import( )
React.lazy
React.Suspense</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> ContextDemo <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./ContextDemo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>引入一个动态组件<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>ContextDemo<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Suspense<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

        <span class="token comment">// 1. 强制刷新，可看到 loading （看不到就限制一下 chrome 网速）</span>
        <span class="token comment">// 2. 看 network 的 js 加载</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> App
</code></pre></div><p>可以把异步引用的组件重新封装成一个组件，然后在dom中用React.Suspense可以等待
5. 性能优化</p> <h4 id="⭐️重点"><a href="#⭐️重点" class="header-anchor">#</a> ⭐️重点</h4> <p>（性能优化对React更重要，相对Vue对性能优化没那么重要）
【1】shouldComponentUpdate(scu)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextState<span class="token punctuation">.</span>count <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// 可以渲染</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// 不重复渲染</span>
<span class="token punctuation">}</span>
</code></pre></div><p>React默认父组件有更新，子组件则无条件也更新</p> <ul><li>SCU默认会返回true，可以通过对比（_isEqual( )深度比较），如果一样就不重新渲染</li> <li>SCU不一定每次都用，需要的时候才优化</li> <li>SCU一定要配合不可变值
父组件的方法里如果这么写，会导致state提前变了值，之后把两个相等的值再进行赋值相等。会导致子组件里两个props相等不触发刷新</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 增加 shouldComponentUpdate</span>
    <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// _.isEqual 做对象或者数组的深度比较（一次性递归到底）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">isEqual</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 相等，则不重复渲染</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// 不相等，则渲染</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>不建议深度比较，比较耗费性能
【2】PureComponent和React.memo（纯组件和备忘录）
class组件：PureComponent在SCU中实现了浅比较
函数组件：memo
<img src="/vuepress-studyNote/assets/img/5.79dab480.png" alt="a">
【3】不可变值immutable.js
每次赋值都重新深拷贝一份，导致性能差
immutable基于共享数据（不是深拷贝），速度好
const map1 = Immutable.Map({a:1,b:2})
const map2 = map1.set({‘b’,50})    //两个分开了
6. 高阶组件hoc
关于组件公共逻辑的抽离
若函数接收的参数是一个函数或返回的值是一个参数则为高阶组件<br>
定义一个HOC，本身是一个函数，接收一个组件返回一个包含公共逻辑的新组件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">HOCFactory</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">HOC</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Compopnent</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span>…<span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant">HOC</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> EnhancedComponent1 <span class="token operator">=</span> <span class="token function">HOCFactory</span><span class="token punctuation">(</span>WrappedComponent1<span class="token punctuation">)</span>
</code></pre></div><p>在组件里通过props获取写的公共逻辑；在高阶组件里面用div包裹一下传入的组件，再在div写逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">withMouse</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">withMouseComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
        <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
  
        <span class="token function-variable function">handleMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                x<span class="token operator">:</span> event<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
                y<span class="token operator">:</span> event<span class="token punctuation">.</span>clientY
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
  
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> height<span class="token operator">:</span> <span class="token string">'500px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> onMouseMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseMove<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span><span class="token comment">/* 1. 透传所有 props 2. 增加 mouse 属性 */</span><span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> mouse<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> withMouseComponent
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> props<span class="token punctuation">.</span>a
    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>mouse <span class="token comment">// 接收 mouse 属性</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> height<span class="token operator">:</span> <span class="token string">'500px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>The mouse position <span class="token function">is</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>y<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>a<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在Redux中connect就是高阶组件：第一个参数传入函数返回一个函数、再第二个参数传入组件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// connect 高阶组件，将 state 和 dispatch 注入到组件 props 中</span>
<span class="token keyword">const</span> VisibleTodoList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span>
</code></pre></div><p>connect源码
<img src="/vuepress-studyNote/assets/img/6.fa219d98.png" alt="a">
Vue如何实现高阶组件？
函数的柯里化：通过函数调用继续返回函数的方式，实现多次接收参数最后统一处理的形式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    用户名：<span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveFormData</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    密码：<span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveFormData</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token comment">//保存表单数据到状态中</span>
<span class="token function-variable function">saveFormData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataType</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>   <span class="token comment">//需要的传参</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  <span class="token comment">//react自动触发的，接收一个事件参数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">[</span>dataType<span class="token punctuation">]</span><span class="token operator">:</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment">//[]的形式可以找到state对象中的对应属性</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//不用柯里化的实现方式：传自己的参数再补充传事件参数</span>
<span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveFormData</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span>event<span class="token punctuation">)</span> <span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><ol start="7"><li>RenderProps
通过一个函数将class组件的state作为props传递给纯函数组件
是APP组件包裹其他组件实现公共逻辑
<img src="/vuepress-studyNote/assets/img/7.d2fc1a52.png" alt="a">
子组件（定义的包含公共逻辑的组件）调用props的render方法传入自己的state
即，定义了 Mouse 组件，只有获取 x y 的能力。至于 Mouse 组件如何渲染，App 说了算，通过 render prop 的方式告诉 Mouse 。
Hoc需要porps之后定义一个属性接收xy，renderprops直接可以获取属性
HOC VS RenderProps:
HOC模式简单，但会增加组件层级；Renderprops代码简洁，学习成本较高</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-studyNote/React/React-Router.html" class="prev">
        Router
      </a></span> <span class="next"><a href="/vuepress-studyNote/Vue/ch01.html">
        基础概念
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-studyNote/assets/js/app.ff2d10b2.js" defer></script><script src="/vuepress-studyNote/assets/js/2.fb00c507.js" defer></script><script src="/vuepress-studyNote/assets/js/11.fa49d6b9.js" defer></script>
  </body>
</html>
